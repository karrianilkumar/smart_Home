<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home Appliance Chat System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"
      rel="stylesheet"
    />
    <style>
      .device-icon {
        transition: all 0.3s ease;
      }
      .device-icon.active {
        color: #fcd34d;
        transform: scale(1.1);
      }
      .device-icon.off {
        color: #9ca3af;
      }
      .fan-icon.active {
        animation: spin 3s linear infinite;
      }
      @keyframes spin {
        100% {
          transform: rotate(360deg);
        }
      }
      .room-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }
    </style>
    <!-- Include the Dialogflow Messenger JavaScript at the end of the head section -->
    <script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
  </head>
  <body class="bg-gray-50 min-h-screen p-6">
    <!-- Dialogflow Messenger widget -->
    <div style="height:50px">
      <df-messenger
        intent="WELCOME"
        chat-title="SmartHomeAgent"
        agent-id="0ffaa1cd-99aa-4c7d-a019-f15f9b4f19cc"
        language-code="en"
      >
      </df-messenger>
    </div>
    <div class="max-w-6xl mx-auto">
      <h1 class="text-4xl font-bold text-gray-800 mb-8 text-center">
        Home Appliance Chat System
      </h1>

      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 me-4">
        <!-- Bedroom -->
        <div
          class="room-card bg-white rounded-xl p-6 shadow-md transition-all duration-300"
        >
          <h2 class="text-2xl font-semibold text-gray-700 mb-4">Bedroom</h2>
          <div class="flex justify-around items-center">
            <div class="text-center">
              <i
                class="fas fa-lightbulb device-icon text-4xl off cursor-pointer"
                id="bedroom-light"
              ></i>
              <p class="mt-2 text-sm text-gray-600">Light</p>
            </div>
            <div class="text-center">
              <i
                class="fas fa-fan device-icon fan-icon text-4xl off cursor-pointer"
                id="bedroom-fan"
              ></i>
              <p class="mt-2 text-sm text-gray-600">Fan</p>
            </div>
            <div class="text-center">
              <i
                class="fas fa-fire device-icon text-4xl off cursor-pointer"
                id="bedroom-heater"
              ></i>
              <p class="mt-2 text-sm text-gray-600">Heater</p>
            </div>
          </div>
        </div>

        <!-- Kitchen -->
        <div
          class="room-card bg-white rounded-xl p-6 shadow-md transition-all duration-300"
        >
          <h2 class="text-2xl font-semibold text-gray-700 mb-4">Kitchen</h2>
          <div class="flex justify-around items-center">
            <div class="text-center">
              <i
                class="fas fa-lightbulb device-icon text-4xl off cursor-pointer"
                id="kitchen-light"
              ></i>
              <p class="mt-2 text-sm text-gray-600">Light</p>
            </div>
            <div class="text-center">
              <i
                class="fas fa-fan device-icon fan-icon text-4xl off cursor-pointer"
                id="kitchen-fan"
              ></i>
              <p class="mt-2 text-sm text-gray-600">Fan</p>
            </div>
            <div class="text-center">
              <i
                class="fas fa-fire device-icon text-4xl off cursor-pointer"
                id="kitchen-heater"
              ></i>
              <p class="mt-2 text-sm text-gray-600">Heater</p>
            </div>
          </div>
        </div>

        <!-- Hall -->
        <div
          class="room-card bg-white rounded-xl p-6 shadow-md transition-all duration-300"
        >
          <h2 class="text-2xl font-semibold text-gray-700 mb-4">Hall</h2>
          <div class="flex justify-around items-center">
            <div class="text-center">
              <i
                class="fas fa-lightbulb device-icon text-4xl off cursor-pointer"
                id="hall-light"
              ></i>
              <p class="mt-2 text-sm text-gray-600">Light</p>
            </div>
            <div class="text-center">
              <i
                class="fas fa-fan device-icon fan-icon text-4xl off cursor-pointer"
                id="hall-fan"
              ></i>
              <p class="mt-2 text-sm text-gray-600">Fan</p>
            </div>
          </div>
        </div>

        <!-- Store Room -->
        <div
          class="room-card bg-white rounded-xl p-6 shadow-md transition-all duration-300"
        >
          <h2 class="text-2xl font-semibold text-gray-700 mb-4">Store Room</h2>
          <div class="flex justify-around items-center">
            <div class="text-center">
              <i
                class="fas fa-lightbulb device-icon text-4xl off cursor-pointer"
                id="storeroom-light"
              ></i>
              <p class="mt-2 text-sm text-gray-600">Light</p>
            </div>
          </div>
        </div>

        <!-- Bathroom -->
        <div
          class="room-card bg-white rounded-xl p-6 shadow-md transition-all duration-300"
        >
          <h2 class="text-2xl font-semibold text-gray-700 mb-4">Bathroom</h2>
          <div class="flex justify-around items-center">
            <div class="text-center">
              <i
                class="fas fa-lightbulb device-icon text-4xl off cursor-pointer"
                id="bathroom-light"
              ></i>
              <p class="mt-2 text-sm text-gray-600">Light</p>
            </div>
            <div class="text-center">
              <i
                class="fas fa-fan device-icon fan-icon text-4xl off cursor-pointer"
                id="bathroom-fan"
              ></i>
              <p class="mt-2 text-sm text-gray-600">Fan</p>
            </div>
          </div>
        </div>

        <!-- Wash Area -->
        <div
          class="room-card bg-white rounded-xl p-6 shadow-md transition-all duration-300"
        >
          <h2 class="text-2xl font-semibold text-gray-700 mb-4">Wash Area</h2>
          <div class="flex justify-around items-center">
            <div class="text-center">
              <i
                class="fas fa-lightbulb device-icon text-4xl off cursor-pointer"
                id="washarea-light"
              ></i>
              <p class="mt-2 text-sm text-gray-600">Light</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      function updateStatus() {
        $.ajax({
          url: "/api/status",
          method: "GET",
          success: function (data) {
            for (const room in data) {
              for (const appliance in data[room]) {
                const elementId = `${room}-${appliance}`;
                const status = data[room][appliance];
                const element = $(`#${elementId}`);

                if (status) {
                  element.removeClass("off").addClass("active");
                } else {
                  element.removeClass("active").addClass("off");
                }
              }
            }
          },
          error: function () {
            console.log("Error fetching status");
          },
        });
      }

      // Add click handlers for manual toggle
      $(".device-icon").click(function () {
        $(this).toggleClass("active off");
        // Here you would typically make an API call to toggle the device
      });

      // Update status every 2 seconds
      $(document).ready(function () {
        updateStatus();
        setInterval(updateStatus, 2000);
      });
    </script>
  </body>
</html>
